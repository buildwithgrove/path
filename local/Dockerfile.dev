FROM docker/tilt:latest

# Install additional dependencies including Python 3 for Tilt's helm extension
RUN apt-get update && apt-get install -y \
    curl \
    git \
    jq \
    make \
    golang \
    procps \
    python3 \
    python3-pip \
    wget \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Install Helm if not already present
RUN if ! command -v helm >/dev/null 2>&1; then \
    echo "Installing Helm..." \
    && curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash; \
    else echo "Helm already installed"; \
    fi

# Install Go 1.23
RUN wget -O go1.23.linux-amd64.tar.gz https://go.dev/dl/go1.23.0.linux-amd64.tar.gz && \
    rm -rf /usr/local/go && \
    tar -C /usr/local -xzf go1.23.linux-amd64.tar.gz && \
    ln -sf /usr/local/go/bin/go /usr/local/bin/go && \
    rm go1.23.linux-amd64.tar.gz

# Create working directory
WORKDIR /app
