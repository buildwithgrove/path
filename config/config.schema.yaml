# This schema file may be used to validate the config file using the `yaml-language-server` VSCode extension.
# See: https://marketplace.visualstudio.com/items?itemName=redhat.vscode-yaml

# To validate the config file, the following comment must be placed at the top of the .config.yaml file:
# <REMOVE THIS TAG> yaml-language-server: $schema=https://raw.githubusercontent.com/buildwithgrove/path/refs/heads/main/config/config.schema.yaml

type: object
additionalProperties: false
required:
  - services

properties:
  # NOTE: Exactly one of either "morse_config" or "shannon_config" must be present

  # TODO_FUTURE: a single PATH deployment can support multiple protocols in theory, but
  # this is not currently supported in order to simplify deployment. In the future, we
  # may look into supporting multiple protocols within a single deployment.

  # Morse Configuration (required for Morse gateways)
  morse_config:
    type: object
    additionalProperties: false
    properties:
      full_node_config:
        type: object
        additionalProperties: false
        required:
          - url
        properties:
          url:
            type: string
            pattern: "^(http|https)://.*$"
          relay_signing_key:
            type: string
            pattern: "^[0-9a-fA-F]{128}$"
          http_config:
            type: object
            additionalProperties: false
            properties:
              retries:
                type: integer
              timeout:
                type: string
              transport:
                type: object
                additionalProperties: false
                properties:
                  max_conns_per_host:
                    type: integer
                  max_idle_conns_per_host:
                    type: integer
                  max_idle_conns:
                    type: integer
                  idle_conn_timeout:
                    type: string
                  dial_timeout:
                    type: string
                  keep_alive:
                    type: string
          request_config:
            type: object
            additionalProperties: false
            properties:
              retries:
                type: integer
      signed_aats:
        type: object
        additionalProperties: false
        patternProperties:
          "^[0-9a-fA-F]{40}$":
            type: object
            additionalProperties: false
            properties:
              client_public_key:
                type: string
                pattern: "^[0-9a-fA-F]{64}$"
              application_public_key:
                type: string
                pattern: "^[0-9a-fA-F]{64}$"
              application_signature:
                type: string
                pattern: "^[0-9a-fA-F]{128}$"
            required:
              - client_public_key
              - application_public_key
              - application_signature

  # Shannon Configuration (required for Shannon gateways)
  shannon_config:
    type: object
    additionalProperties: false
    required:
      - full_node_config
      - gateway_config
    properties:
      full_node_config:
        type: object
        additionalProperties: false
        required:
          - rpc_url
          - grpc_config
        properties:
          rpc_url:
            type: string
            pattern: "^(http|https)://.*$"
          grpc_config:
            type: object
            additionalProperties: false
            required:
              - host_port
            properties:
              host_port:
                type: string
                pattern: "^[^:]+:[0-9]+$"
              insecure:
                type: boolean
                default: false
              base_delay:
                type: string
              max_delay:
                type: string
              min_connect_timeout:
                type: string
              keep_alive_time:
                type: string
              keep_alive_timeout:
                type: string
          lazy_mode:
            type: boolean
            default: false
      gateway_config:
        type: object
        additionalProperties: false
        required:
          - gateway_mode
          - gateway_address
          - gateway_private_key_hex
        properties:
          gateway_mode:
            type: string
            enum: ["centralized", "delegated", "permissionless"]
          gateway_address:
            type: string
            pattern: "^pokt1[0-9a-zA-Z]{38}$" # 43 total characters
          gateway_private_key_hex:
            type: string
            pattern: "^[0-9a-fA-F]{64}$"
          owned_apps_private_keys_hex: # Not required in delegated gateway mode
            type: array
            items:
              type: string
              pattern: "^[0-9a-fA-F]{64}$"

  # Services Configuration (required)
  services:
    type: object
    additionalProperties: false
    patternProperties:
      "^[a-zA-Z0-9]+$":
        type: object
        additionalProperties: false
        properties:
          alias:
            type: string
          request_timeout:
            type: string

  # Router Configuration (optional)
  router_config:
    type: object
    additionalProperties: false
    properties:
      port:
        type: integer
      max_request_body_size:
        type: integer
      read_timeout:
        type: string
      write_timeout:
        type: string
      idle_timeout:
        type: string

  # Hydrator Configuration (optional)
  hydrator_config:
    type: object
    additionalProperties: false
    properties:
      service_ids:
        type: array
        items:
          type: string
